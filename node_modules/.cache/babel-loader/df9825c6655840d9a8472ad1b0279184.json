{"ast":null,"code":"var _jsxFileName = \"/home/gustavo/q2/gestao3/capstone-q2-educ-financeira-g4/src/Providers/Users/index.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../Services/api\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport { showToast } from \"../../Components/Toast/style\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const UserContext = /*#__PURE__*/createContext({});\nexport const UserProvider = ({\n  children\n}) => {\n  _s();\n\n  // const {  } = useContext(ModalContext)\n  const [userData, setUserData] = useState({});\n  const history = useHistory();\n  const [UserToken, setUserToken] = useState(() => localStorage.getItem(\"token\") || \"\");\n  const [userId, setUserId] = useState(() => localStorage.getItem(\"userId\") || \"\");\n  const [activities, setActivities] = useState([]);\n  const [isValidToken, setIsValidToken] = useState(false);\n  const [typeUser, setTypeUser] = useState(() => localStorage.getItem(\"typeUser\") || \"\");\n\n  const Login = userData => {\n    api.post(\"login\", userData).then(response => {\n      localStorage.setItem(\"userId\", response.data.user.id);\n      localStorage.setItem(\"amountToPay\", \"0\");\n      setUserId(response.data.user.id);\n      localStorage.setItem(\"typeUser\", response.data.user.type);\n      setTypeUser(response.data.user.type);\n      localStorage.setItem(\"token\", response.data.accessToken);\n      showToast({\n        type: \"success\",\n        message: \"Sucesso ao logar\"\n      });\n      setUserToken(response.data.accessToken);\n      setUserData(response.data.user);\n      response.data.user.type === \"parent\" ? history.push(\"/dashboardparents\") : history.push(\"/dashboardkids\");\n    }).catch(err => {\n      console.log(err);\n      showToast({\n        type: \"error\",\n        message: \"Erro, ao tentar logar!\"\n      });\n    });\n  };\n\n  const Logout = () => {\n    localStorage.clear();\n    showToast({\n      type: \"success\",\n      message: \"Você esta deslogado!\"\n    });\n    setUserToken(\"\");\n    history.push(\"/\");\n  };\n\n  const Register = ParentUserData => {\n    api.post(\"register\", ParentUserData).then(() => {\n      history.push(\"/login\");\n      showToast({\n        type: \"success\",\n        message: ParentUserData.type === \"children\" ? \"Agora seu dependente pode começar a aprender sobre educação financeira\" : \"Parabéns, você criou uma conta!\"\n      });\n    }).catch(err => {\n      console.log(err);\n      showToast({\n        type: \"error\",\n        message: \"Erro, ao criar dependente!\"\n      });\n    });\n  };\n\n  const AddWishList = (data, wish) => {\n    data.wishlist.push(wish);\n    console.log(data);\n    api.patch(`users/${data.id}`, data, {\n      headers: {\n        Authorization: `Bearer ${UserToken}`\n      }\n    }).then(response => {\n      console.log(response.data);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const ReceivedBalance = (data, value) => {\n    const send = {\n      date: new Date().toLocaleString(),\n      move: value\n    };\n    data.balance.push(send);\n    data.wallet += value;\n    api.patch(`users/${data.id}`, data, {\n      headers: {\n        Authorization: `Bearer ${UserToken}`\n      }\n    }).then(response => {\n      getUserData();\n      console.log(response.data);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const SpendBalance = (data, value) => {\n    const send = {\n      date: new Date().toLocaleString().replace(/(\\d*)-(\\d*)-(\\d*).*/, '$3/$2/$1'),\n      move: value\n    };\n    data.balance.push(send);\n    data.wallet += value;\n    api.patch(`users/${data.id}`, data, {\n      headers: {\n        Authorization: `Bearer ${UserToken}`\n      }\n    }).then(response => {\n      getUserData();\n      console.log(response.data);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const getUserData = () => {\n    api.get(`users/${localStorage.getItem(\"userId\")}`, {\n      headers: {\n        Authorization: `Bearer ${UserToken}`\n      }\n    }).then(reponse => {\n      setUserData(reponse.data);\n      console.log(\"userdata\", userData);\n      console.log(\"response\", reponse);\n    }).catch(e => {\n      console.log(e);\n      localStorage.clear();\n    });\n  };\n\n  const AddtoKitty = (wish, value) => {\n    const el = userData.wishlist.map(item => {\n      if (item.name === wish.name) {\n        return {\n          name: wish.name,\n          value: wish.value,\n          kitty: wish.kitty + value\n        };\n      }\n\n      return item;\n    });\n    const send = userData.wishlist.filter(element => element.name === wish.name);\n    console.log(\"send\", send);\n    const data = {\n      wishlist: el\n    };\n    const id = localStorage.getItem(\"userId\");\n    SpendBalance(userData, -value);\n    console.log(data);\n    api.patch(`users/${id}`, data, {\n      headers: {\n        Authorization: `Bearer ${UserToken}`\n      }\n    }).then(response => {\n      console.log(\"response\", response);\n      getUserData();\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const GetActivities = userId => {\n    api.get(`activities/?userId=${userId}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n      }\n    }).then(response => {\n      setActivities(response.data);\n    });\n  };\n\n  const isTokenValid = () => {\n    api.get(`users/${localStorage.getItem(\"userId\")}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n      }\n    }).then(resp => {}).catch(e => {\n      console.log(\"token expirado\");\n      Logout();\n    });\n  };\n\n  const EditProfile = data => {\n    api.patch(`/users/${userData.id}`, data, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n      }\n    }).then(response => {\n      setUserData(response.data);\n      showToast({\n        type: \"success\",\n        message: \"Perfil editado\"\n      });\n    });\n  };\n\n  const SelectedChild = id => {\n    api.get(`/users/${id}`, {\n      headers: {\n        Authorization: `Bearer ${localStorage.getItem(\"token\")}`\n      }\n    }).then(response => {\n      const data = {\n        name: response.data.name,\n        email: response.data.email,\n        password: response.data.password,\n        children: response.data.children,\n        parentId: response.data.parentId,\n        id: response.data.id,\n        balance: [...response.data.balance],\n        wishlist: [...response.data.wishlist],\n        wallet: response.data.wallet,\n        type: \"parent\"\n      };\n      console.log(data);\n      setUserData(data);\n      history.push(\"/balance\");\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: {\n      UserToken,\n      Login,\n      Logout,\n      Register,\n      userData,\n      AddWishList,\n      SpendBalance,\n      ReceivedBalance,\n      getUserData,\n      AddtoKitty,\n      activities,\n      GetActivities,\n      userId,\n      isValidToken,\n      isTokenValid,\n      typeUser,\n      EditProfile,\n      SelectedChild\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 321,\n    columnNumber: 5\n  }, this);\n};\n\n_s(UserProvider, \"0ovTHYDDvj/LIFI0vli62JwcrFk=\", false, function () {\n  return [useHistory];\n});\n\n_c = UserProvider;\nexport const useUser = () => {\n  _s2();\n\n  return useContext(UserContext);\n};\n\n_s2(useUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"sources":["/home/gustavo/q2/gestao3/capstone-q2-educ-financeira-g4/src/Providers/Users/index.tsx"],"names":["createContext","useContext","useState","useHistory","api","showToast","UserContext","UserProvider","children","userData","setUserData","history","UserToken","setUserToken","localStorage","getItem","userId","setUserId","activities","setActivities","isValidToken","setIsValidToken","typeUser","setTypeUser","Login","post","then","response","setItem","data","user","id","type","accessToken","message","push","catch","err","console","log","Logout","clear","Register","ParentUserData","AddWishList","wish","wishlist","patch","headers","Authorization","ReceivedBalance","value","send","date","Date","toLocaleString","move","balance","wallet","getUserData","SpendBalance","replace","get","reponse","e","AddtoKitty","el","map","item","name","kitty","filter","element","GetActivities","isTokenValid","resp","EditProfile","SelectedChild","email","password","parentId","useUser"],"mappings":"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","sourcesContent":["import { createContext, ReactNode, useContext, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../Services/api\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport { showToast } from \"../../Components/Toast/style\";\n\ninterface UserProps {\n  children: ReactNode;\n}\n\ninterface UserData {\n  email: string;\n  password: string;\n}\n\ninterface UserDataItens {\n  name: string;\n  email: string;\n  password: string;\n  wallet: number;\n  wishlist: Wish[];\n  balance: Balance[];\n  children: Children[];\n  parentId: number;\n  id?: number;\n  type: string;\n}\n\ninterface Wish {\n  name: string;\n  value: number;\n  kitty: number;\n}\n\nexport interface Balance {\n  date: string;\n  move: number;\n}\n\ninterface Children {\n  childrenId: number;\n}\ninterface activity {\n  childAchivied: boolean,\n  parentAchivied: boolean,\n  frequency: string;\n  name: string;\n  reward: number;\n  userId: number;\n  id: number;\n}\n\ninterface EditProfileData {\n  name?: string;\n  password?: string;\n}\ninterface UserProviderData {\n  Login: (userData: UserData) => void;\n  Logout: () => void;\n  Register: (userData: UserDataItens) => void;\n  UserToken: string;\n  activities: activity[];\n  GetActivities: (userId: number) => void;\n  userData: UserDataItens;\n  AddWishList: (data: UserDataItens, wish: Wish) => void;\n  SpendBalance: (data: UserDataItens, number: number) => void;\n  ReceivedBalance: (data: UserDataItens, number: number) => void;\n  AddtoKitty: (item: Wish, value: number) => void;\n  getUserData: () => void;\n  isValidToken: boolean;\n  isTokenValid: () => void;\n  typeUser: string;\n  userId: string;\n  EditProfile: (data: EditProfileData) => void;\n  SelectedChild: (id: number) => void;\n}\nexport const UserContext = createContext<UserProviderData>(\n  {} as UserProviderData\n);\n\nexport const UserProvider = ({ children }: UserProps) => {\n  // const {  } = useContext(ModalContext)\n  const [userData, setUserData] = useState<UserDataItens>({} as UserDataItens);\n  const history = useHistory();\n  const [UserToken, setUserToken] = useState(\n    () => localStorage.getItem(\"token\") || \"\"\n  );\n  const [userId, setUserId] = useState(\n    () => localStorage.getItem(\"userId\") || \"\"\n  );\n  const [activities, setActivities] = useState([] as activity[]);\n  const [isValidToken, setIsValidToken] = useState<boolean>(false);\n\n  const [typeUser, setTypeUser] = useState(\n    () => localStorage.getItem(\"typeUser\") || \"\"\n  );\n\n  const Login = (userData: UserData) => {\n    api\n      .post(\"login\", userData)\n      .then((response) => {\n        localStorage.setItem(\"userId\", response.data.user.id);\n        localStorage.setItem(\"amountToPay\", \"0\")\n        setUserId(response.data.user.id);\n        localStorage.setItem(\"typeUser\", response.data.user.type);\n        setTypeUser(response.data.user.type);\n        localStorage.setItem(\"token\", response.data.accessToken);\n        showToast({ type: \"success\", message: \"Sucesso ao logar\" });\n        setUserToken(response.data.accessToken);\n        setUserData(response.data.user);\n        response.data.user.type === \"parent\"\n          ? history.push(\"/dashboardparents\")\n          : history.push(\"/dashboardkids\");\n      })\n      .catch((err) => {\n        console.log(err);\n        showToast({ type: \"error\", message: \"Erro, ao tentar logar!\" });\n      });\n  };\n\n  const Logout = () => {\n    localStorage.clear();\n    showToast({ type: \"success\", message: \"Você esta deslogado!\" });\n    setUserToken(\"\");\n    history.push(\"/\");\n  };\n\n  const Register = (ParentUserData: UserDataItens) => {\n    api\n      .post(\"register\", ParentUserData)\n      .then(() => {\n        history.push(\"/login\");\n        showToast({\n          type: \"success\",\n          message:\n            ParentUserData.type === \"children\"\n              ? \"Agora seu dependente pode começar a aprender sobre educação financeira\"!\n              : \"Parabéns, você criou uma conta!\",\n        });\n      })\n      .catch((err) => {\n        console.log(err);\n        showToast({ type: \"error\", message: \"Erro, ao criar dependente!\" });\n      });\n  };\n\n  const AddWishList = (data: UserDataItens, wish: Wish) => {\n    data.wishlist.push(wish);\n    console.log(data);\n    api\n      .patch(`users/${data.id}`, data, {\n        headers: {\n          Authorization: `Bearer ${UserToken}`,\n        },\n      })\n      .then((response) => {\n        console.log(response.data);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const ReceivedBalance = (data: UserDataItens, value: number) => {\n    const send = { date: new Date().toLocaleString(), move: value };\n    data.balance.push(send);\n    data.wallet += value;\n    api\n      .patch(`users/${data.id}`, data, {\n        headers: {\n          Authorization: `Bearer ${UserToken}`,\n        },\n      })\n      .then((response) => {\n        getUserData();\n        console.log(response.data);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const SpendBalance = (data: UserDataItens, value: number) => {\n    const send = { date: new Date().toLocaleString().replace(/(\\d*)-(\\d*)-(\\d*).*/, '$3/$2/$1'), move: value };\n    data.balance.push(send);\n    data.wallet += value;\n    api\n      .patch(`users/${data.id}`, data, {\n        headers: {\n          Authorization: `Bearer ${UserToken}`,\n        },\n      })\n      .then((response) => {\n        getUserData();\n        console.log(response.data);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const getUserData = () => {\n    api\n      .get(`users/${localStorage.getItem(\"userId\")}`, {\n        headers: {\n          Authorization: `Bearer ${UserToken}`,\n        },\n      })\n      .then((reponse) => {\n        setUserData(reponse.data);\n\n        console.log(\"userdata\", userData);\n        console.log(\"response\", reponse);\n      })\n      .catch((e) => {\n        console.log(e);\n        localStorage.clear();\n      });\n  };\n\n  const AddtoKitty = (wish: Wish, value: number) => {\n    const el = userData.wishlist.map((item) => {\n      if (item.name === wish.name) {\n        return {\n          name: wish.name,\n          value: wish.value,\n          kitty: wish.kitty + value,\n        };\n      }\n      return item;\n    });\n    const send = userData.wishlist.filter(\n      (element) => element.name === wish.name\n    );\n    console.log(\"send\", send);\n    const data = { wishlist: el };\n    const id = localStorage.getItem(\"userId\");\n    SpendBalance(userData, -value);\n    console.log(data);\n    api\n      .patch(`users/${id}`, data, {\n        headers: {\n          Authorization: `Bearer ${UserToken}`,\n        },\n      })\n      .then((response) => {\n        console.log(\"response\", response);\n        getUserData();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  };\n\n  const GetActivities = (userId: number) => {\n    api\n      .get(`activities/?userId=${userId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n      })\n      .then((response) => {\n        setActivities(response.data);\n      });\n  };\n\n  const isTokenValid = () => {\n    api\n      .get(`users/${localStorage.getItem(\"userId\")}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n      })\n      .then((resp) => {\n      })\n      .catch((e) => {\n        console.log(\"token expirado\");\n        Logout();\n      });\n  };\n  const EditProfile = (data: EditProfileData) => {\n    api\n      .patch(`/users/${userData.id}`, data, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n      })\n      .then((response) => {\n        setUserData(response.data);\n        showToast({ type: \"success\", message: \"Perfil editado\" });\n      });\n  };\n\n  const SelectedChild = (id: number) => {\n    api\n      .get(`/users/${id}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n        },\n      })\n      .then((response) => {\n        const data = {\n          name: response.data.name,\n          email: response.data.email,\n          password: response.data.password,\n          children: response.data.children,\n          parentId: response.data.parentId,\n          id: response.data.id,\n          balance: [...response.data.balance],\n          wishlist: [...response.data.wishlist],\n          wallet: response.data.wallet,\n          type: \"parent\",\n        };\n        console.log(data);\n        setUserData(data);\n        history.push(\"/balance\");\n      });\n  };\n\n  return (\n    <UserContext.Provider\n      value={{\n        UserToken,\n        Login,\n        Logout,\n        Register,\n        userData,\n        AddWishList,\n        SpendBalance,\n        ReceivedBalance,\n        getUserData,\n        AddtoKitty,\n        activities,\n        GetActivities,\n        userId,\n        isValidToken,\n        isTokenValid,\n        typeUser,\n        EditProfile,\n        SelectedChild,\n      }}\n    >\n      {children}\n    </UserContext.Provider>\n  );\n};\n\nexport const useUser = () => useContext(UserContext);\n"]},"metadata":{},"sourceType":"module"}